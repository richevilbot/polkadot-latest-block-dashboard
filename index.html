<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Polkadot Latest Block Dashboard</title>
  <style>
    :root {
      --bg:#0b1020; --panel:#131b38; --text:#e9eeff; --muted:#9aa8cc; --line:#2a3561; --accent:#7fb3ff;
    }
    html[data-theme='light'] { --bg:#f6f8ff; --panel:#ffffff; --text:#18213f; --muted:#5d6b93; --line:#d6def7; --accent:#295ce6; }
    body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:20px}
    .top{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px;margin-top:12px}
    .muted{color:var(--muted)}
    button{background:var(--panel);color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px 12px;cursor:pointer}
    table{width:100%;border-collapse:collapse;font-size:.92rem}
    th,td{border-bottom:1px solid var(--line);padding:8px;text-align:left;vertical-align:top}
    .pill{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid var(--line);font-size:.8rem}
  </style>
</head>
<body>
  <main class="wrap">
    <div class="top">
      <div>
        <h1 style="margin:0">Polkadot Latest Block</h1>
        <div class="muted">Updates every 30s • countdown: <span id="countdown">30</span>s</div>
      </div>
      <button id="themeBtn">Toggle Light/Dark</button>
    </div>

    <section class="card">
      <div class="muted">Latest Block</div>
      <h2 id="blockNumber" style="margin:6px 0">-</h2>
      <div>Hash: <span id="blockHash" class="muted">-</span></div>
      <div>Parent: <span id="parentHash" class="muted">-</span></div>
      <div>Time: <span id="updated" class="muted">-</span></div>
    </section>

    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
        <h3 style="margin:0">Extrinsics in Latest Block</h3>
        <span id="txCount" class="pill">0 items</span>
      </div>
      <div style="overflow:auto;margin-top:10px">
        <table>
          <thead><tr><th>#</th><th>Pallet</th><th>Method</th><th>Signer</th><th>Success</th></tr></thead>
          <tbody id="rows"><tr><td colspan="5" class="muted">Loading…</td></tr></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const API = 'https://rpc.polkadot.io';
    const cdEl = document.getElementById('countdown');
    let left = 30;

    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
    async function rpc(method, params=[]) {
      const res = await fetch(API, {method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({id:1,jsonrpc:'2.0',method,params})});
      const j = await res.json();
      if (j.error) throw new Error(j.error.message || 'RPC error');
      return j.result;
    }

    function short(v){ return v ? v.slice(0,18)+'…' : '-'; }

    async function fetchLatest() {
      const head = await rpc('chain_getFinalizedHead');
      const block = await rpc('chain_getBlock', [head]);
      const numHex = block.block.header.number;
      const num = parseInt(numHex,16);

      document.getElementById('blockNumber').textContent = `#${num}`;
      document.getElementById('blockHash').textContent = head;
      document.getElementById('parentHash').textContent = block.block.header.parentHash;
      document.getElementById('updated').textContent = new Date().toLocaleString();

      const ext = block.block.extrinsics || [];
      document.getElementById('txCount').textContent = `${ext.length} items`;
      const rows = document.getElementById('rows');

      if (!ext.length) {
        rows.innerHTML = '<tr><td colspan="5" class="muted">No extrinsics in this block.</td></tr>';
        return;
      }

      rows.innerHTML = ext.map((hex, i) => {
        const guess = hex.slice(0, 20);
        return `<tr><td>${i}</td><td class="muted">(encoded)</td><td class="muted">${guess}…</td><td class="muted">-</td><td>unknown</td></tr>`;
      }).join('');
    }

    async function refreshLoop(){
      try { await fetchLatest(); } catch(e){ document.getElementById('rows').innerHTML = `<tr><td colspan="5" class='muted'>Error: ${e.message}</td></tr>`; }
      left = 30;
    }

    setInterval(()=>{
      left -= 1;
      if(left <= 0){ refreshLoop(); left = 30; }
      cdEl.textContent = String(left);
    }, 1000);

    document.getElementById('themeBtn').addEventListener('click', ()=>{
      const html = document.documentElement;
      html.setAttribute('data-theme', html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    });

    refreshLoop();
  </script>
</body>
</html>
